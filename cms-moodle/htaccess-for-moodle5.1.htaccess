# -------------------------------------------------
# For MOODLE >= 5.1
# -------------------------------------------------
RewriteEngine On
RewriteBase /

# -------------------------------------------------
# Force trailing slash for "directory-like" URLs
# -------------------------------------------------
RewriteCond %{REQUEST_URI} !\..+$          # not a file (no dot)
RewriteCond %{REQUEST_URI} !/$             # no trailing slash
RewriteCond %{REQUEST_URI} !^/public/      # avoid recursion
RewriteRule ^(.+)$ $1/ [R=301,L]

# -------------------------------------------------
# Redirect / â†’ /public/
# -------------------------------------------------
RewriteRule ^$ public/ [L]

# -------------------------------------------------
# Skip rewriting if already in /public
# -------------------------------------------------
RewriteCond %{REQUEST_URI} !^/public/

# -------------------------------------------------
# Explicitly rewrite /admin requests internally
# -------------------------------------------------
RewriteRule ^/admin(/.*)?$ public/admin$1 [L]

# -------------------------------------------------
# Internally rewrite everything else to /public/
# -------------------------------------------------
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ public/$1 [L]

